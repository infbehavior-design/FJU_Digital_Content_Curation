---
/**
 * Tailwind + scroll-snap ç‰ˆæœ¬èª²ç¨‹è¶³è·¡è¼ªæ’­
 * æƒ³æ”¹å¡ç‰‡å…§å®¹ â†’ èª¿æ•´ä¸‹é¢ cards é™£åˆ—ã€‚
 */

const cards = [
  {
    title: "å¥ å®šåŸºç¤",
    date: "114.09 ~ 114.09",
    imageLabel: "Image",
    link: "#",
  },
  {
    title: "æ•™è‚²è¨“ç·´",
    date: "114.09 ~ 114.09",
    imageLabel: "Image",
    link: "#",
  },
  {
    title: "å¯¦åœ°åƒè¨ª",
    date: "114.09 ~ 114.10",
    imageLabel: "Image",
    link: "#",
  },
  {
    title: "äº‹å‰æº–å‚™",
    date: "114.10 ~ 114.11",
    imageLabel: "Image",
    link: "#",
  },
  {
    title: "æ¡è¨ªä½œæ¥­",
    date: "114.11.12",
    imageLabel: "Image",
    link: "#",
  },
  {
    title: "æˆæœç™¼è¡¨",
    date: "114.11 ~ 114.12",
    imageLabel: "Image",
    link: "#",
  },
];
---

<section id="footprint" class="min-h-screen flex items-center justify-center bg-[#b3734f]">
  <!-- å¯¬åº¦ = 90vwï¼Œä½†æœ€å¤§ä¸è¶…é 1280px -->
  <div class="w-[90vw] max-w-[1280px] mx-auto text-center px-4 lg:px-8">
    <!-- æ¨™é¡Œ -->
    <h2 class="text-[clamp(28px,3vw,40px)] tracking-[0.12em] text-[#fff8f0] mb-10">
      èª²ç¨‹è¶³è·¡
    </h2>

    <div class="flex items-center gap-6">
      <!-- å·¦ç®­é ­ -->
      <button
        id="timeline-prev"
        class="w-14 h-14 rounded-full border-2 border-[#f6e2c9] text-[#f6e2c9] flex items-center justify-center shrink-0 transition
               hover:bg-[#f6e2c9] hover:text-[#424729]
               disabled:opacity-30 disabled:cursor-default disabled:hover:bg-transparent disabled:hover:text-[#f6e2c9]"
        aria-label="ä¸Šä¸€å¼µ">
        â†
      </button>

      <!-- æ²å‹•å®¹å™¨ï¼šsnap-x + snap-mandatory -->
      <div
        id="timeline-scroll"
        class="relative flex-1 overflow-x-auto scroll-smooth snap-x snap-mandatory flex gap-6
        px-4 sm:px-8 lg:px-10 py-4">
        <!-- å·¦é‚Šç•™ç™½ç”¨çš„ã€Œéš±å½¢å¡ã€ -->
        <div class="shrink-0 w-[10vw] sm:w-[12vw] lg:w-[14vw] snap-none"></div>

        {cards.map((card, idx) => (
          <article
            data-index={idx}
            class="timeline-snap-card shrink-0 snap-center w-[260px] md:w-[320px]">
            <div
              class="timeline-snap-inner flex flex-col items-center justify-start
                     rounded-[32px] bg-[#424729] text-[#fff8f0]
                     shadow-[0_10px_30px_rgba(0,0,0,0.25)]
                     px-6 pt-8 pb-10 transition-transform duration-300">

              <div class="text-2xl mb-2">ğŸƒ</div>

              <h3 class="text-2xl md:text-3xl tracking-[0.08em] mb-2 text-[#fff8f0]">
                {card.title}
              </h3>

              <div class="text-sm md:text-base mb-6">{card.date}</div>

              <div
                class="w-full aspect-[4/3] rounded-3xl bg-[#e6c59b]
                       flex items-center justify-center
                       text-xl font-semibold text-[#5b4026] mb-6">
                {card.imageLabel}
              </div>

              <button
                type="button"
                class="mt-auto px-7 py-2 rounded-full border border-[#f6e2c9] text-[#f6e2c9] tracking-[0.12em] text-sm md:text-base transition hover:bg-[#f6e2c9] hover:text-[#424729]"
                data-link={card.link}
                >
                äº†è§£æ›´å¤š
              </button>
            </div>
          </article>
        ))}
        <!-- å³é‚Šç•™ç™½ç”¨çš„ã€Œéš±å½¢å¡ã€ -->
        <div class="shrink-0 w-[10vw] sm:w-[12vw] lg:w-[14vw] snap-none"></div>
      </div>

      <!-- å³ç®­é ­ -->
      <button
        id="timeline-next"
        class="w-14 h-14 rounded-full border-2 border-[#f6e2c9] text-[#f6e2c9] flex items-center justify-center shrink-0 transition
               hover:bg-[#f6e2c9] hover:text-[#424729]
               disabled:opacity-30 disabled:cursor-default disabled:hover:bg-transparent disabled:hover:text-[#f6e2c9]"
        aria-label="ä¸‹ä¸€å¼µ">
        â†’
      </button>
    </div>

    <!-- ä¸‹æ–¹è£é£¾ -->
    <div class="mt-8 text-xs tracking-[0.4em] text-[#fff8f0]/80 select-none">
      Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â·
    </div>
  </div>
</section>


<!-- è£œä¸€é»å…¨åŸŸ CSSï¼šæ”¾å¤§æ•ˆæœ + æ²è»¸éš±è— -->
<style is:global>
  /* ä¸­é–“é‚£å¼µ active å¡ç‰‡æ”¾å¤§ */
  .timeline-snap-card.is-active .timeline-snap-inner {
    transform: scale(1.06);
    box-shadow: 0 22px 50px rgba(0, 0, 0, 0.45);
  }

  /* éš±è—æ©«å‘æ²è»¸ï¼ˆä¿ç•™æ²å‹•åŠŸèƒ½ï¼‰ */
  #timeline-scroll::-webkit-scrollbar {
    display: none;
  }
  #timeline-scroll {
    scrollbar-width: none;
  }
</style>

<script is:inline>
  const container = document.getElementById("timeline-scroll");
  const prevBtn = document.getElementById("timeline-prev");
  const nextBtn = document.getElementById("timeline-next");

  if (container && prevBtn && nextBtn) {
    const cards = Array.from(
      container.querySelectorAll(".timeline-snap-card"),
    );
    let activeIndex = 0;

    function clampIndex(i) {
      return Math.max(0, Math.min(cards.length - 1, i));
    }

    function updateButtons() {
      // å¾ªç’°æ¨¡å¼ â†’ æŒ‰éˆ•æ°¸é å¯ç”¨
      prevBtn.disabled = false;
      nextBtn.disabled = false;
    }


    function updateActiveClass() {
      cards.forEach((card, idx) => {
        card.classList.toggle("is-active", idx === activeIndex);
      });
    }

    function scrollToIndex(newIndex, withScroll = true) {
      activeIndex = clampIndex(newIndex);
      const target = cards[activeIndex];
      updateActiveClass();
      updateButtons();

      if (withScroll && target) {
        target.scrollIntoView({
          behavior: "smooth",
          inline: "center",
          block: "nearest",
        });
      }
    }

    prevBtn.addEventListener("click", () => {
      if (activeIndex === 0) {
        scrollToIndex(cards.length - 1); // è·³åˆ°æœ€å¾Œä¸€å¼µ
      } else {
        scrollToIndex(activeIndex - 1);
      }
    });

    nextBtn.addEventListener("click", () => {
      if (activeIndex === cards.length - 1) {
        scrollToIndex(0); // å›åˆ°ç¬¬ä¸€å¼µ
      } else {
        scrollToIndex(activeIndex + 1);
      }
    });

    // ä½¿ç”¨è€…è‡ªè¡Œæ»‘å‹•æ™‚ï¼Œè‡ªå‹•æ›´æ–°å“ªä¸€å¼µæ˜¯ active
    let rAF = null;
    container.addEventListener("scroll", () => {
      if (rAF !== null) cancelAnimationFrame(rAF);
      rAF = requestAnimationFrame(() => {
        const containerRect = container.getBoundingClientRect();
        const containerCenter = containerRect.left + containerRect.width / 2;

        let closestIndex = activeIndex;
        let closestDist = Infinity;

        cards.forEach((card, idx) => {
          const rect = card.getBoundingClientRect();
          const cardCenter = rect.left + rect.width / 2;
          const dist = Math.abs(cardCenter - containerCenter);
          if (dist < closestDist) {
            closestDist = dist;
            closestIndex = idx;
          }
        });

        if (closestIndex !== activeIndex) {
          // æ›´æ–° active ä½†ä¸è¦å†è§¸ç™¼ scrollIntoViewï¼Œé¿å…äº’ç›¸å¹²æ“¾
          scrollToIndex(closestIndex, false);
        }
      });
    });

    // åˆå§‹åŒ–ï¼šæ²åˆ°ç¬¬ä¸€å¼µï¼Œè®“ snap-center å¹«æˆ‘å€‘ç½®ä¸­
    scrollToIndex(0);
  }

  document.querySelectorAll("[data-link]").forEach((btn) => {
  btn.addEventListener("click", () => {
    const url = btn.getAttribute("data-link");
    if (url && url !== "#") window.location.href = url;
  });
});

</script>
